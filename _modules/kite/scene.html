<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>kite.scene &#8212; Kite  documentation</title>
    <link rel="stylesheet" href="../../_static/pydoctheme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/sidebar.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <link rel="shortcut icon" type="image/png" href="../../_static/favicon.png" />
    <meta name="viewport" content="width=device-width,initial-scale=0.8">
    
    
      <link rel="stylesheet" type="text/css"
        href="https://fonts.googleapis.com/css?family=Roboto+Slab">
    
    

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="responsive-menu"><a href="#sidebar-anchor" title="Navigation">&#9776;</a></li>
        <li><a href="../../index.html">Kite  documentation</a> &#187;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>
    
  

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <h1>Source code for kite.scene</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/bin/python</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">num</span>
<span class="kn">import</span> <span class="nn">utm</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="k">as</span> <span class="nn">op</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span> <span class="k">as</span> <span class="n">dt</span>

<span class="kn">from</span> <span class="nn">pyrocko</span> <span class="k">import</span> <span class="n">guts</span>
<span class="kn">from</span> <span class="nn">pyrocko.orthodrome</span> <span class="k">import</span> <span class="n">latlon_to_ne</span>  <span class="c1"># noqa</span>

<span class="kn">from</span> <span class="nn">kite.quadtree</span> <span class="k">import</span> <span class="n">QuadtreeConfig</span>
<span class="kn">from</span> <span class="nn">kite.covariance</span> <span class="k">import</span> <span class="n">CovarianceConfig</span>
<span class="kn">from</span> <span class="nn">kite.util</span> <span class="k">import</span> <span class="n">Subject</span><span class="p">,</span> <span class="n">property_cached</span><span class="p">,</span> <span class="n">greatCircleDistance</span>
<span class="kn">from</span> <span class="nn">kite</span> <span class="k">import</span> <span class="n">scene_io</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="n">Scene</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scene</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ImportError</span><span class="p">,</span> <span class="n">UserIOWarning</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scene</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;Could not read file </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_setDataNumpy</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">num</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">variable</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;value must be of type numpy.ndarray&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UserIOWarning</span><span class="p">(</span><span class="ne">UserWarning</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">class</span> <span class="nc">SceneError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="FrameConfig"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.FrameConfig">[docs]</a><span class="k">class</span> <span class="nc">FrameConfig</span><span class="p">(</span><span class="n">guts</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Config object holding :class:`kite.scene.Scene` cobfiguration &#39;&#39;&#39;</span>
    <span class="n">llLat</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Scene latitude of lower left corner&#39;</span><span class="p">)</span>
    <span class="n">llLon</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Scene longitude of lower left corner&#39;</span><span class="p">)</span>
    <span class="n">dLat</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Scene pixel spacing in x direction [deg]&#39;</span><span class="p">)</span>
    <span class="n">dLon</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1.e-3</span><span class="p">,</span></div>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Scene pixel spacing in y direction [deg]&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Frame"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Frame">[docs]</a><span class="k">class</span> <span class="nc">Frame</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; UTM frame holding geographical references for :class:`kite.scene.Scene`</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">evChanged</span> <span class="o">=</span> <span class="n">Subject</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">FrameConfig</span><span class="p">()):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span> <span class="o">=</span> <span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">getChild</span><span class="p">(</span><span class="s1">&#39;Frame&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">extentE</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extentN</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spherical_distortion</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urE</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urN</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dN</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dE</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llEutm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llNutm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">utm_zone</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llN</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llE</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">offsetE</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsetN</span> <span class="o">=</span> <span class="mf">0.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_updateConfig</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">evConfigChanged</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateConfig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">evChanged</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_updateExtent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_updateConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">frame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">frame</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_updateExtent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evChanged</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_updateExtent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">cols</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">llEutm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llNutm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">utm_zone</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">utm_zone_letter</span> <span class="o">=</span>\
            <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llLat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llLon</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">rows</span>

        <span class="n">urlat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llLat</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dLat</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span>
        <span class="n">urlon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">llLon</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">dLon</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urEutm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">urNutm</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="n">urlat</span><span class="p">,</span> <span class="n">urlon</span><span class="p">,</span>
                                                         <span class="bp">self</span><span class="o">.</span><span class="n">utm_zone</span><span class="p">)</span>

        <span class="c1"># Width at the bottom of the scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extentE</span> <span class="o">=</span> <span class="n">greatCircleDistance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llLat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llLon</span><span class="p">,</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">llLat</span><span class="p">,</span> <span class="n">urlon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extentN</span> <span class="o">=</span> <span class="n">greatCircleDistance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">llLat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llLon</span><span class="p">,</span>
                                           <span class="n">urlat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llLon</span><span class="p">)</span>

        <span class="c1"># Width at the N&#39; top of the scene</span>
        <span class="n">extentE_top</span> <span class="o">=</span> <span class="n">greatCircleDistance</span><span class="p">(</span><span class="n">urlat</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">llLon</span><span class="p">,</span>
                                          <span class="n">urlat</span><span class="p">,</span> <span class="n">urlon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spherical_distortion</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extentE</span> <span class="o">-</span> <span class="n">extentE_top</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dE</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">extentE</span> <span class="o">+</span> <span class="n">extentE_top</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extentN</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rows</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dN</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offsetN</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">llE</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">llN</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">urN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">regularize</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gridE</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gridN</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">llLat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">llLat</span>

    <span class="nd">@llLat</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">llLat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llLat</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">llLat</span> <span class="o">=</span> <span class="n">llLat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_llLat</span> <span class="o">=</span> <span class="n">llLat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateExtent</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">llLon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">llLon</span>

    <span class="nd">@llLon</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">llLon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">llLon</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">llLon</span> <span class="o">=</span> <span class="n">llLon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_llLon</span> <span class="o">=</span> <span class="n">llLon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateExtent</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dLat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dLat</span>

    <span class="nd">@dLat</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dLat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dLat</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dLat</span> <span class="o">=</span> <span class="n">dLat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateExtent</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dLon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dLon</span>

    <span class="nd">@dLon</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">dLon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dLon</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dLon</span> <span class="o">=</span> <span class="n">dLon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateExtent</span><span class="p">()</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">gridE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; UTM grid holding eastings of all pixels in ``NxM`` matrix</span>
<span class="sd">            of :attr:`~kite.Scene.displacement`.</span>

<span class="sd">        :type: :class:`numpy.ndarray`, size ``NxM``</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">valid_data</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">displacement</span><span class="p">)</span>
        <span class="n">gridE</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">gridE</span><span class="p">,</span> <span class="n">valid_data</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">gridN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; UTM grid holding northings of all pixels in ``NxM`` matrix</span>
<span class="sd">            of :attr:`~kite.Scene.displacement`.</span>

<span class="sd">        :type: :class:`numpy.ndarray`, size ``NxM``</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">valid_data</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">displacement</span><span class="p">)</span>
        <span class="n">gridN</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">[:,</span> <span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">(</span><span class="n">gridN</span><span class="p">,</span> <span class="n">valid_data</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="n">num</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">[</span><span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">[:,</span> <span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">coords</span>

<div class="viewcode-block" id="Frame.setENOffset"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Frame.setENOffset">[docs]</a>    <span class="k">def</span> <span class="nf">setENOffset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">north</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set scene offsets in local cartesian coordinates.</span>

<span class="sd">        :param east: East offset in [m]</span>
<span class="sd">        :type east: float, :class:`numpy.ndarray` or None</span>
<span class="sd">        :param north: North offset in [m]</span>
<span class="sd">        :type north: float, :class:`numpy.ndarray` or None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsetE</span> <span class="o">=</span> <span class="n">east</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offsetN</span> <span class="o">=</span> <span class="n">north</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">_updateExtent</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setLatLonReference</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="Frame.mapMatrixEN"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Frame.mapMatrixEN">[docs]</a>    <span class="k">def</span> <span class="nf">mapMatrixEN</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Maps matrix row, column to local easting and northing.</span>

<span class="sd">        :param row: Matrix row number</span>
<span class="sd">        :type row: int</span>
<span class="sd">        :param col: Matrix column number</span>
<span class="sd">        :type col: int</span>
<span class="sd">        :returns: Easting and northing in local coordinates</span>
<span class="sd">        :rtype: tuple (float), (easting, northing)</span>
<span class="sd">        &#39;&#39;&#39;</span></div>
        <span class="k">return</span> <span class="n">row</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dE</span><span class="p">,</span> <span class="n">col</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">dN</span>

<div class="viewcode-block" id="Frame.mapENMatrix"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Frame.mapENMatrix">[docs]</a>    <span class="k">def</span> <span class="nf">mapENMatrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Maps local coordinates (easting and northing) to matrix</span>
<span class="sd">            row and column</span>

<span class="sd">        :param E: Easting in local coordinates</span>
<span class="sd">        :type E: float</span>
<span class="sd">        :param N: Northing in local coordinates</span>
<span class="sd">        :type N: float</span>
<span class="sd">        :returns: Row and column</span>
<span class="sd">        :rtype: tuple (int), (row, column)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">row</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">E</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dE</span><span class="p">)</span> <span class="k">if</span> <span class="n">E</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">dN</span><span class="p">)</span> <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span></div>
        <span class="k">return</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="s1">&#39;Lower right latitude:  </span><span class="si">{frame.llLat:.4f}</span><span class="s1"> N</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Lower right longitude: </span><span class="si">{frame.llLon:.4f}</span><span class="s1"> E</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;UTM Zone:              </span><span class="si">{frame.utm_zone}{frame.utm_zone_letter}</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Lower right easting:   </span><span class="si">{frame.llE:.4f}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Lower right northing:  </span><span class="si">{frame.llN:.4f}</span><span class="s1"> m&#39;</span>
            <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Pixel spacing east:    </span><span class="si">{frame.dE:.4f}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Pixel spacing north:   </span><span class="si">{frame.dN:.4f}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Extent east:           </span><span class="si">{frame.extentE:.4f}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Extent north:          </span><span class="si">{frame.extentN:.4f}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Dimensions:            </span><span class="si">{frame.cols}</span><span class="s1"> x </span><span class="si">{frame.rows}</span><span class="s1"> px</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="s1">&#39;Spherical distortion:  </span><span class="si">{frame.spherical_distortion:.4f}</span><span class="s1"> m</span><span class="se">\n</span><span class="s1">&#39;</span></div>
        <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>


<div class="viewcode-block" id="Meta"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Meta">[docs]</a><span class="k">class</span> <span class="nc">Meta</span><span class="p">(</span><span class="n">guts</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Meta configuration for ``Scene``.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">scene_title</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Undefined&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Scene title&#39;</span><span class="p">)</span>
    <span class="n">scene_id</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Scene identification&#39;</span><span class="p">)</span>
    <span class="n">satellite_name</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Undefined&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Satellite mission name&#39;</span><span class="p">)</span>
    <span class="n">wavelength</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Float</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Wavelength in [m]&#39;</span><span class="p">)</span>
    <span class="n">orbit_direction</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">StringChoice</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Ascending&#39;</span><span class="p">,</span> <span class="s1">&#39;Descending&#39;</span><span class="p">,</span> <span class="s1">&#39;Undefined&#39;</span><span class="p">],</span>
        <span class="n">default</span><span class="o">=</span><span class="s1">&#39;Undefined&#39;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Orbital direction, ascending/descending&#39;</span><span class="p">)</span>
    <span class="n">time_master</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1481116161.930574</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Timestamp for master acquisition&#39;</span><span class="p">)</span>
    <span class="n">time_slave</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="mf">1482239325.482</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Timestamp for slave acquisition&#39;</span><span class="p">)</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">Dict</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Extra header information&#39;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">String</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">optional</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_separation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :getter: Absolute time difference between ``time_master``</span>
<span class="sd">                 and ``time_slave``</span>
<span class="sd">        :type: timedelta</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">dt</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_slave</span><span class="p">)</span> <span class="o">-</span>\</div>
            <span class="n">dt</span><span class="o">.</span><span class="n">fromtimestamp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time_master</span><span class="p">)</span>


<div class="viewcode-block" id="SceneConfig"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.SceneConfig">[docs]</a><span class="k">class</span> <span class="nc">SceneConfig</span><span class="p">(</span><span class="n">guts</span><span class="o">.</span><span class="n">Object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Configuration object, gathering ``kite.Scene`` and</span>
<span class="sd">        sub-objects configuration.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">Meta</span><span class="p">(),</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Scene metainformation&#39;</span><span class="p">)</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">FrameConfig</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">FrameConfig</span><span class="p">(),</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Frame/reference configuration&#39;</span><span class="p">)</span>
    <span class="n">quadtree</span> <span class="o">=</span> <span class="n">QuadtreeConfig</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">QuadtreeConfig</span><span class="p">(),</span>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Quadtree parameters&#39;</span><span class="p">)</span>
    <span class="n">covariance</span> <span class="o">=</span> <span class="n">CovarianceConfig</span><span class="o">.</span><span class="n">T</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="n">CovarianceConfig</span><span class="p">(),</span></div>
        <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Covariance parameters&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">dynamicmethod</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Decorator for dynamic classmethod / instancemethod declaration &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">dynclassmethod</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Scene</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">Scene</span><span class="p">(),</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">dynclassmethod</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__doc__</span>
    <span class="n">dynclassmethod</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="k">return</span> <span class="n">dynclassmethod</span>


<div class="viewcode-block" id="BaseScene"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.BaseScene">[docs]</a><span class="k">class</span> <span class="nc">BaseScene</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initLogging</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_displacement</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_phi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_theta</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">los</span> <span class="o">=</span> <span class="n">LOSUnitVectors</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">frame_config</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;frame_config&#39;</span><span class="p">,</span> <span class="n">FrameConfig</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">fattr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;llLat&#39;</span><span class="p">,</span> <span class="s1">&#39;llLon&#39;</span><span class="p">,</span> <span class="s1">&#39;dLat&#39;</span><span class="p">,</span> <span class="s1">&#39;dLon&#39;</span><span class="p">]:</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">fattr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">frame_config</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">fattr</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">frame_config</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;displacement&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">]:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initLogging</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_log_stream</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_stream</span> <span class="o">=</span> <span class="n">l</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_stream</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_stream</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_stream</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_stream</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setLogLevel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_stream</span><span class="o">.</span><span class="n">setLevel</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Geodetical displacement in [m].</span>

<span class="sd">        :setter: Set the unwrapped InSAR displacement.</span>
<span class="sd">        :getter: Return the displacement matrix.</span>
<span class="sd">        :type: :class:`numpy.ndarray`, ``NxM``</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_displacement</span>

    <span class="nd">@displacement</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">_setDataNumpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_displacement&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_displacement</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement_mask</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evChanged</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">displacement_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Displacement :attr:`numpy.nan` mask</span>

<span class="sd">        :type: :class:`numpy.ndarray`, dtype :class:`numpy.bool`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">displacement</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Horizontal angle towards satellite&#39; :abbr:`line of sight (LOS)`</span>
<span class="sd">            in [rad]</span>

<span class="sd">        .. important ::</span>

<span class="sd">            Kite convention is:</span>

<span class="sd">            * :math:`0` is **East**</span>
<span class="sd">            * :math:`\\frac{\\pi}{2}` is **North**!</span>

<span class="sd">        :setter: Set the phi matrix for scene&#39;s displacement, can be int</span>
<span class="sd">                 for static look vector.</span>
<span class="sd">        :type: :class:`numpy.ndarray`, size same as</span>
<span class="sd">               :attr:`~kite.Scene.displacement` or int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_phi</span>

    <span class="nd">@phi</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">phi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_phi</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_setDataNumpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_phi&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">los_rotation_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evChanged</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">theta</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Theta is look vector elevation angle towards satellite from horizon</span>
<span class="sd">            in radians. Matrix of theta towards satellite&#39;s</span>
<span class="sd">            :abbr:`line of sight (LOS)`.</span>

<span class="sd">        .. important ::</span>

<span class="sd">            Kite convention!</span>

<span class="sd">            * :math:`-\\frac{\\pi}{2}` is **Down**</span>
<span class="sd">            * :math:`\\frac{\\pi}{2}` is **Up**</span>

<span class="sd">        :setter: Set the theta matrix for scene&#39;s displacement, can be int</span>
<span class="sd">                 for static look vector.</span>
<span class="sd">        :type: :class:`numpy.ndarray`, size same as</span>
<span class="sd">               :attr:`~kite.Scene.displacement` or int</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_theta</span>

    <span class="nd">@theta</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">theta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_theta</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_setDataNumpy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_theta&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">los_rotation_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evChanged</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">thetaDeg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; LOS elevation angle in degree, ``NxM`` matrix like</span>
<span class="sd">            :class:`kite.Scene.theta`</span>

<span class="sd">        :type: :class:`numpy.ndarray`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">phiDeg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; LOS horizontal orientation angle in degree, ``NxM`` matrix like</span>
<span class="sd">            :class:`kite.Scene.theta`</span>

<span class="sd">        :type: :class:`numpy.ndarray`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">los_rotation_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Trigonometric factors to rotate displacement matrices towards LOS</span>

<span class="sd">        Rotation is as follows:</span>

<span class="sd">        ..</span>
<span class="sd">            displacement_los =\</span>
<span class="sd">                (los_rotation_factors[:, :, 0] * -down +</span>
<span class="sd">                 los_rotation_factors[:, :, 1] * east +</span>
<span class="sd">                 los_rotation_factors[:, :, 2] * north)</span>

<span class="sd">        :returns: Factors for rotation</span>
<span class="sd">        :rtype: :class:`numpy.ndarray`, ``NxMx3``</span>
<span class="sd">        :raises: AttributeError</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;LOS angles inconsistent with provided&#39;</span>
                                 <span class="s1">&#39; coordinate shape.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_los_factors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_los_factors</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                           <span class="mi">3</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_los_factors</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_los_factors</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>\
                <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_los_factors</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>\
                <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_los_factors</span>


<div class="viewcode-block" id="Scene"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Scene">[docs]</a><span class="k">class</span> <span class="nc">Scene</span><span class="p">(</span><span class="n">BaseScene</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Scene of unwrapped InSAR ground dispacements measurements</span>

<span class="sd">    :param config: Configuration object</span>
<span class="sd">    :type config: :class:`SceneConfig`, optional</span>

<span class="sd">    Optional parameters</span>

<span class="sd">    :param displacement: Displacement in [m]</span>
<span class="sd">    :type displacement: :class:`numpy.ndarray`, NxM, optional</span>
<span class="sd">    :param theta: Theta look angle, see :attr:`Scene.theta`</span>
<span class="sd">    :type theta: :class:`numpy.ndarray`, NxM, optional</span>
<span class="sd">    :param phi: Phi look angle, see :attr:`Scene.phi`</span>
<span class="sd">    :type phi: :class:`numpy.ndarray`, NxM, optional</span>

<span class="sd">    :param llLat: Lower left latitude in [deg]</span>
<span class="sd">    :type llLat: float, optional</span>
<span class="sd">    :param llLon: Lower left longitude in [deg]</span>
<span class="sd">    :type llLon: float, optional</span>
<span class="sd">    :param dLat: Pixel spacing in latitude [deg]</span>
<span class="sd">    :type dLat: float, optional</span>
<span class="sd">    :param dLon: Pixel spacing in longitude [deg]</span>
<span class="sd">    :type dLon: float, optional</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">evChanged</span> <span class="o">=</span> <span class="n">Subject</span><span class="p">()</span>
    <span class="n">evConfigChanged</span> <span class="o">=</span> <span class="n">Subject</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="n">SceneConfig</span><span class="p">(),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta</span>

        <span class="n">BaseScene</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame_config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># wiring special methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_import_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">quadtree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Instanciates the scene&#39;s quadtree.</span>

<span class="sd">        :type: :class:`kite.quadtree.Quadtree`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Creating kite.Quadtree instance&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">kite.quadtree</span> <span class="k">import</span> <span class="n">Quadtree</span>
        <span class="k">return</span> <span class="n">Quadtree</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">quadtree</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Instanciates the scene&#39;s covariance attribute.</span>

<span class="sd">        :type: :class:`kite.covariance.Covariance`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Creating kite.Covariance instance&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">kite.covariance</span> <span class="k">import</span> <span class="n">Covariance</span>
        <span class="k">return</span> <span class="n">Covariance</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">covariance</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Shows a simple plot of the scene&#39;s displacement</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Creating kite.ScenePlot instance&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">kite.plot2d</span> <span class="k">import</span> <span class="n">ScenePlot</span>
        <span class="k">return</span> <span class="n">ScenePlot</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Scene.spool"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Scene.spool">[docs]</a>    <span class="k">def</span> <span class="nf">spool</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Start the spool user interface :class:`~kite.spool.Spool` to inspect</span>
<span class="sd">        the scene.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">displacement</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">SceneError</span><span class="p">(</span><span class="s1">&#39;Can not display an empty scene.&#39;</span><span class="p">)</span>
        <span class="kn">from</span> <span class="nn">kite.spool</span> <span class="k">import</span> <span class="n">Spool</span>
        <span class="n">spool</span> <span class="o">=</span> <span class="n">Spool</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>
        <span class="k">return</span> <span class="n">spool</span><span class="o">.</span><span class="n">spool_win</span><span class="o">.</span><span class="n">buildViews</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_testImport</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">E</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">N</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gridE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">gridN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dE</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">displacement</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">theta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">phi</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span> <span class="n">e</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;Something went wrong during import - &#39;</span>
                              <span class="s1">&#39;see Exception!&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Scene.save"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.Scene.save">[docs]</a>    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Save kite scene to kite file structure</span>

<span class="sd">        Saves the current scene meta information and UTM frame to a YAML</span>
<span class="sd">        (``.yml``) file. Numerical data (:attr:`~kite.Scene.displacement`,</span>
<span class="sd">        :attr:`~kite.Scene.theta` and :attr:`~kite.Scene.phi`)</span>
<span class="sd">        are saved as binary files from :class:`numpy.ndarray`.</span>

<span class="sd">        :param filename: Filenames to save scene to, defaults to</span>
<span class="sd">            &#39; :attr:`~kite.Scene.meta.scene_id` ``_``</span>
<span class="sd">            :attr:`~kite.Scene.meta.scene_view`</span>
<span class="sd">        :type filename: str, optional</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="ow">or</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">scene_id</span><span class="p">,</span>
                                          <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">scene_view</span><span class="p">)</span>
        <span class="n">_file</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">_file</span> <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.yml&#39;</span><span class="p">,</span> <span class="s1">&#39;.npz&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">filename</span>

        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;displacement&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Saving scene data to </span><span class="si">%s</span><span class="s1">.npz&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

        <span class="n">num</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.npz&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">),</span>
                  <span class="o">*</span><span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span> <span class="k">for</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">components</span><span class="p">])</span></div>
        <span class="bp">self</span><span class="o">.</span><span class="n">saveConfig</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.yml&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">saveConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="n">_file</span><span class="p">,</span> <span class="n">ext</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span> <span class="k">if</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.yml&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.yml&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Saving scene config to </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">,</span>
                         <span class="n">header</span><span class="o">=</span><span class="s1">&#39;kite.Scene YAML Config&#39;</span><span class="p">)</span>

    <span class="nd">@dynamicmethod</span>
    <span class="k">def</span> <span class="nf">_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Load a kite scene from file ``filename.[npz,yml]``</span>
<span class="sd">        structure.</span>

<span class="sd">        :param filename: Filenames the scene data is saved under</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        :returns: Scene object from data resources</span>
<span class="sd">        :rtype: :class:`~kite.Scene`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;displacement&#39;</span><span class="p">,</span> <span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">]</span>

        <span class="n">basename</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Loading from </span><span class="si">%s</span><span class="s1">[.npz,.yml]&#39;</span> <span class="o">%</span> <span class="n">basename</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.npz&#39;</span> <span class="o">%</span> <span class="n">basename</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">components</span><span class="p">):</span>
                <span class="n">scene</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;arr_</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserIOWarning</span><span class="p">(</span><span class="s1">&#39;Could not load data from </span><span class="si">%s</span><span class="s1">.npz&#39;</span> <span class="o">%</span> <span class="n">basename</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">scene</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.yml&#39;</span> <span class="o">%</span> <span class="n">basename</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UserIOWarning</span><span class="p">(</span><span class="s1">&#39;Could not load </span><span class="si">%s</span><span class="s1">.yml&#39;</span> <span class="o">%</span> <span class="n">basename</span><span class="p">)</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">_testImport</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">scene</span>

    <span class="n">load</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_load</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Loading config from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">guts</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">meta</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">evConfigChanged</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="nd">@dynamicmethod</span>
    <span class="k">def</span> <span class="nf">_import_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Import displacement data from foreign file format.</span>

<span class="sd">        :param path: Filename of resource to import</span>
<span class="sd">        :type path: str</span>
<span class="sd">        :param kwargs: keyword arguments passed to import function</span>
<span class="sd">        :type kwargs: dict</span>
<span class="sd">        :returns: Scene from path</span>
<span class="sd">        :rtype: :class:`~kite.Scene`</span>
<span class="sd">        :raises: TypeError</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">op</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="ow">or</span> <span class="n">op</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;File </span><span class="si">%s</span><span class="s1"> does not exist!&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">scene_io</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;scene_io.</span><span class="si">%s</span><span class="s1">(scene)&#39;</span> <span class="o">%</span> <span class="n">mod</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">module</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
                <span class="n">scene</span><span class="o">.</span><span class="n">_log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Importing </span><span class="si">%s</span><span class="s1"> using </span><span class="si">%s</span><span class="s1"> module&#39;</span> <span class="o">%</span>
                                 <span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mod</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s1">&#39;Could not recognize format for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">path</span><span class="p">)</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scene</span><span class="o">.</span><span class="n">_import_from_dict</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">_import_data</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> \
        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Supported import modules are **</span><span class="si">%s</span><span class="s1">**.</span><span class="se">\n</span><span class="s1">&#39;</span>\
        <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">scene_io</span><span class="o">.</span><span class="n">__all__</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">mod</span> <span class="ow">in</span> <span class="n">scene_io</span><span class="o">.</span><span class="n">__all__</span><span class="p">:</span>
        <span class="n">_import_data</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">**</span><span class="si">%s</span><span class="s1">**</span><span class="se">\n\n</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">mod</span>
        <span class="n">_import_data</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">+=</span> <span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;scene_io.</span><span class="si">%s</span><span class="s1">.__doc__&#39;</span> <span class="o">%</span> <span class="n">mod</span><span class="p">)</span>
    <span class="n">import_data</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">_import_data</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_import_from_dict</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;theta&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;displacement&#39;</span><span class="p">]:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">sk</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">sk</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">fk</span><span class="p">,</span> <span class="n">fv</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;frame&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="n">fk</span><span class="p">,</span> <span class="n">fv</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">mk</span><span class="p">,</span> <span class="n">mv</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;meta&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">mv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="p">,</span> <span class="n">mk</span><span class="p">,</span> <span class="n">mv</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">extra</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;extra&#39;</span><span class="p">])</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">_testImport</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">scene</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></div>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>


<div class="viewcode-block" id="LOSUnitVectors"><a class="viewcode-back" href="../../reference/kite.scene.html#kite.LOSUnitVectors">[docs]</a><span class="k">class</span> <span class="nc">LOSUnitVectors</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Decompose line-of-sight (LOS) angles derived from</span>
<span class="sd">    :attr:`~kite.Scene.displacement` to unit vector.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scene</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span> <span class="o">=</span> <span class="n">scene</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">evChanged</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_flush_vectors</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_flush_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unitE</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unitN</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unitU</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">unitE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Unit vector east component, ``NxM`` matrix like</span>
<span class="sd">            :attr:`~kite.Scene.displacement`</span>
<span class="sd">        :type: :class:`numpy.ndarray`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">unitN</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Unit vector north component, ``NxM`` matrix like</span>
<span class="sd">            :attr:`~kite.Scene.displacement`</span>
<span class="sd">        :type: :class:`numpy.ndarray`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">phi</span><span class="p">)</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>

    <span class="nd">@property_cached</span>
    <span class="k">def</span> <span class="nf">unitU</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Unit vector vertical (up) component, ``NxM`` matrix like</span>
<span class="sd">            :attr:`~kite.Scene.displacement`</span>
<span class="sd">        :type: :class:`numpy.ndarray`</span>
<span class="sd">        &#39;&#39;&#39;</span></div>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scene</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TestScene</span><span class="p">(</span><span class="n">Scene</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Test scenes for synthetic displacement &#39;&#39;&#39;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">createGauss</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">noise</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">scene_title</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Displacement | Gaussian&#39;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prepareSceneTest</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="n">scene</span><span class="o">.</span><span class="n">_gaussAnomaly</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
                                                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">noise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">addNoise</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scene</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">createRandom</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Displacement | Uniform Random&#39;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prepareSceneTest</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

        <span class="n">rand_state</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1010</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="p">(</span><span class="n">rand_state</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span><span class="o">-.</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>

        <span class="k">return</span> <span class="n">scene</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">createSine</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nx</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">ny</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">kE</span><span class="o">=.</span><span class="mi">0041</span><span class="p">,</span> <span class="n">kN</span><span class="o">=.</span><span class="mi">0061</span><span class="p">,</span> <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                   <span class="n">noise</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Synthetic Displacement | Sine&#39;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prepareSceneTest</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span>

        <span class="n">E</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">E</span><span class="p">,</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        <span class="n">displ</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">E</span><span class="p">)</span>

        <span class="n">kE</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">kE</span>
        <span class="n">kN</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">kN</span>

        <span class="k">for</span> <span class="n">ke</span> <span class="ow">in</span> <span class="n">kE</span><span class="p">:</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">displ</span> <span class="o">+=</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ke</span> <span class="o">*</span> <span class="n">E</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">kn</span> <span class="ow">in</span> <span class="n">kN</span><span class="p">:</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">displ</span> <span class="o">+=</span> <span class="n">num</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kn</span> <span class="o">*</span> <span class="n">N</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>
        <span class="n">displ</span> <span class="o">-=</span> <span class="n">num</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">displ</span><span class="p">)</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="n">displ</span> <span class="o">*</span> <span class="n">amplitude</span>
        <span class="k">if</span> <span class="n">noise</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scene</span><span class="o">.</span><span class="n">addNoise</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">scene</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">createFractal</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">nE</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">nN</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
                      <span class="n">beta</span><span class="o">=</span><span class="p">[</span><span class="mf">5.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">8.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">2.</span><span class="o">/</span><span class="mi">3</span><span class="p">],</span> <span class="n">regime</span><span class="o">=</span><span class="p">[</span><span class="o">.</span><span class="mi">15</span><span class="p">,</span> <span class="o">.</span><span class="mi">99</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span>
                      <span class="n">amplitude</span><span class="o">=</span><span class="mf">1.</span><span class="p">):</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span>\
            <span class="s1">&#39;Synthetic Displacement | Fractal Noise (Hanssen, 2001)&#39;</span>
        <span class="n">scene</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_prepareSceneTest</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">nE</span><span class="p">,</span> <span class="n">nN</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nE</span><span class="o">+</span><span class="n">nN</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ArithmeticError</span><span class="p">(</span><span class="s1">&#39;Dimensions of synthetic scene must &#39;</span>
                                  <span class="s1">&#39;both be even!&#39;</span><span class="p">)</span>

        <span class="n">dE</span><span class="p">,</span> <span class="n">dN</span> <span class="o">=</span> <span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dE</span><span class="p">,</span> <span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dN</span><span class="p">)</span>

        <span class="n">rfield</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">nE</span><span class="p">,</span> <span class="n">nN</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fft2</span><span class="p">(</span><span class="n">rfield</span><span class="p">)</span>

        <span class="n">kE</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">nE</span><span class="p">,</span> <span class="n">dE</span><span class="p">)</span>
        <span class="n">kN</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">fftfreq</span><span class="p">(</span><span class="n">nN</span><span class="p">,</span> <span class="n">dN</span><span class="p">)</span>
        <span class="n">k_rad</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">kN</span><span class="p">[:,</span> <span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">kE</span><span class="p">[</span><span class="n">num</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">regime</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">regime</span><span class="p">)</span>
        <span class="n">k0</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">regime</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">k_rad</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">regime</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">k_rad</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">r0</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">k_rad</span> <span class="o">&gt;</span> <span class="n">k0</span><span class="p">,</span> <span class="n">k_rad</span> <span class="o">&lt;</span> <span class="n">k1</span><span class="p">)</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">k_rad</span> <span class="o">&gt;=</span> <span class="n">k1</span><span class="p">,</span> <span class="n">k_rad</span> <span class="o">&lt;</span> <span class="n">k2</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">k_rad</span> <span class="o">&gt;=</span> <span class="n">k2</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
        <span class="c1"># From Hanssen (2001)</span>
        <span class="c1">#   beta+1 is used as beta, since, the power exponent</span>
        <span class="c1">#   is defined for a 1D slice of the 2D spectrum:</span>
        <span class="c1">#   austin94: &quot;Adler, 1981, shows that the surface profile</span>
        <span class="c1">#   created by the intersection of a plane and a</span>
        <span class="c1">#   2-D fractal surface is itself fractal with</span>
        <span class="c1">#   a fractal dimension  equal to that of the 2D</span>
        <span class="c1">#   surface decreased by one.&quot;</span>
        <span class="n">beta</span> <span class="o">+=</span> <span class="mf">1.</span>
        <span class="c1"># From Hanssen (2001)</span>
        <span class="c1">#   The power beta/2 is used because the power spectral</span>
        <span class="c1">#   density is proportional to the amplitude squared</span>
        <span class="c1">#   Here we work with the amplitude, instead of the power</span>
        <span class="c1">#   so we should take sqrt( k.^beta) = k.^(beta/2)  RH</span>
        <span class="c1"># beta /= 2.</span>

        <span class="n">amp</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">k_rad</span><span class="p">)</span>
        <span class="n">amp</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_rad</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span> <span class="o">**</span> <span class="o">-</span><span class="n">beta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">amp</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span> <span class="o">/=</span> <span class="n">amp</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">amp</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_rad</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span> <span class="o">**</span> <span class="o">-</span><span class="n">beta</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">amp</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span> <span class="o">/=</span> <span class="n">amp</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">amp</span><span class="p">[</span><span class="n">r0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">amp</span><span class="p">[</span><span class="n">r2</span><span class="p">]</span> <span class="o">=</span> <span class="n">k_rad</span><span class="p">[</span><span class="n">r2</span><span class="p">]</span> <span class="o">**</span> <span class="o">-</span><span class="n">beta</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">amp</span><span class="p">[</span><span class="n">r2</span><span class="p">]</span> <span class="o">/=</span> <span class="n">amp</span><span class="p">[</span><span class="n">r2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">amp</span><span class="p">[</span><span class="n">r1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="n">amp</span><span class="p">[</span><span class="n">k_rad</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

        <span class="n">spec</span> <span class="o">*=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">num</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
        <span class="n">disp</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">num</span><span class="o">.</span><span class="n">fft</span><span class="o">.</span><span class="n">ifft2</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
        <span class="n">disp</span> <span class="o">-=</span> <span class="n">num</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>

        <span class="n">scene</span><span class="o">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="n">disp</span>
        <span class="k">return</span> <span class="n">scene</span>

    <span class="k">def</span> <span class="nf">addNoise</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">noise_amplitude</span><span class="p">):</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">()</span>
        <span class="n">noise</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">displacement</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise_amplitude</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displacement</span> <span class="o">+=</span> <span class="n">noise</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_prepareSceneTest</span><span class="p">(</span><span class="n">scene</span><span class="p">,</span> <span class="n">nE</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">nN</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">llLat</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">llLon</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dLat</span> <span class="o">=</span> <span class="mf">5e-4</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">dLon</span> <span class="o">=</span> <span class="mf">5e-4</span>
        <span class="c1"># scene.frame.E = num.arange(nE) * 50.</span>
        <span class="c1"># scene.frame.N = num.arange(nN) * 50.</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">theta</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span>
            <span class="n">num</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="n">nE</span><span class="p">),</span> <span class="n">nN</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nE</span><span class="p">,</span> <span class="n">nN</span><span class="p">))</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">phi</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">scene</span><span class="o">.</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">scene</span><span class="o">.</span><span class="n">displacement</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nE</span><span class="p">,</span> <span class="n">nN</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">scene</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_gaussAnomaly</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sigma_x</span><span class="o">=.</span><span class="mi">007</span><span class="p">,</span> <span class="n">sigma_y</span><span class="o">=.</span><span class="mi">005</span><span class="p">,</span>
                      <span class="n">amplitude</span><span class="o">=</span><span class="mf">3.</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">x0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">y0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">+</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">y</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">gauss_anomaly</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> \
            <span class="n">num</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(((</span><span class="n">X</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma_x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">y0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma_y</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">gauss_anomaly</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Scene&#39;</span><span class="p">,</span> <span class="s1">&#39;SceneConfig&#39;</span><span class="p">]</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">testScene</span> <span class="o">=</span> <span class="n">TestScene</span><span class="o">.</span><span class="n">createGauss</span><span class="p">()</span>
</pre></div>

          </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
    &nbsp;
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
      </ul>
    </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, IfG University of Kiel, BridGeS project - Marius Paul Isken, Henriette Sudhaus, Andreas Steinberg, Sebastian Heimann.
    </div>
  </body>
</html>